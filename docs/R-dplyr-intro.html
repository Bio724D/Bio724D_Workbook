<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bio724D - 5&nbsp; Introduction to dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./R-ggplot-intro.html" rel="next">
<link href="./R-intro-RMarkdown.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to <code>dplyr</code></span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Bio724D</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Computing Basics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Computing_basics/local-computing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Local computing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Computing_basics/remote-computing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Remote computing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-getting-started.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting Started with R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-intro-RMarkdown.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">R Markdown and R Notebooks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-dplyr-intro.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to <code>dplyr</code></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./R-ggplot-intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to ggplot2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Unix</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unix/Unix-bash.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Bash scripts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unix/Unix-awk.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Awk</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#libraries" id="toc-libraries" class="nav-link active" data-scroll-target="#libraries"><span class="toc-section-number">5.1</span>  Libraries</a></li>
  <li><a href="#reading-data-with-the-readr-package" id="toc-reading-data-with-the-readr-package" class="nav-link" data-scroll-target="#reading-data-with-the-readr-package"><span class="toc-section-number">5.2</span>  Reading data with the <code>readr</code> package</a>
  <ul class="collapse">
  <li><a href="#reading-excel-files" id="toc-reading-excel-files" class="nav-link" data-scroll-target="#reading-excel-files"><span class="toc-section-number">5.2.1</span>  Reading Excel files</a></li>
  <li><a href="#example-data-nc-births" id="toc-example-data-nc-births" class="nav-link" data-scroll-target="#example-data-nc-births"><span class="toc-section-number">5.2.2</span>  Example data: NC Births</a></li>
  </ul></li>
  <li><a href="#a-note-on-tibbles" id="toc-a-note-on-tibbles" class="nav-link" data-scroll-target="#a-note-on-tibbles"><span class="toc-section-number">5.3</span>  A note on “tibbles”</a></li>
  <li><a href="#data-filtering-and-transformation-with-dplyr" id="toc-data-filtering-and-transformation-with-dplyr" class="nav-link" data-scroll-target="#data-filtering-and-transformation-with-dplyr"><span class="toc-section-number">5.4</span>  Data filtering and transformation with <code>dplyr</code></a></li>
  <li><a href="#dplyrs-verbs" id="toc-dplyrs-verbs" class="nav-link" data-scroll-target="#dplyrs-verbs"><span class="toc-section-number">5.5</span>  dplyr’s “verbs”</a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><span class="toc-section-number">5.5.1</span>  <code>select</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><span class="toc-section-number">5.5.2</span>  <code>filter</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><span class="toc-section-number">5.5.3</span>  <code>mutate</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><span class="toc-section-number">5.5.4</span>  <code>arrange</code></a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize"><span class="toc-section-number">5.5.5</span>  <code>summarize</code></a></li>
  <li><a href="#group_by" id="toc-group_by" class="nav-link" data-scroll-target="#group_by"><span class="toc-section-number">5.5.6</span>  <code>group_by</code></a></li>
  <li><a href="#combining-grouping-and-summarizing" id="toc-combining-grouping-and-summarizing" class="nav-link" data-scroll-target="#combining-grouping-and-summarizing"><span class="toc-section-number">5.5.7</span>  Combining grouping and summarizing</a></li>
  <li><a href="#scoped-variants-of-mutate-and-summarize" id="toc-scoped-variants-of-mutate-and-summarize" class="nav-link" data-scroll-target="#scoped-variants-of-mutate-and-summarize"><span class="toc-section-number">5.5.8</span>  Scoped variants of <code>mutate</code> and <code>summarize</code></a></li>
  <li><a href="#combining-summarize-with-grouping-aesthetics-in-ggplot2" id="toc-combining-summarize-with-grouping-aesthetics-in-ggplot2" class="nav-link" data-scroll-target="#combining-summarize-with-grouping-aesthetics-in-ggplot2"><span class="toc-section-number">5.5.9</span>  Combining summarize with grouping aesthetics in <code>ggplot2</code></a></li>
  </ul></li>
  <li><a href="#pipes" id="toc-pipes" class="nav-link" data-scroll-target="#pipes"><span class="toc-section-number">5.6</span>  Pipes</a>
  <ul class="collapse">
  <li><a href="#install-and-load-magrittr" id="toc-install-and-load-magrittr" class="nav-link" data-scroll-target="#install-and-load-magrittr"><span class="toc-section-number">5.6.1</span>  Install and load <code>magrittr</code></a></li>
  <li><a href="#the-basic-pipe-operator" id="toc-the-basic-pipe-operator" class="nav-link" data-scroll-target="#the-basic-pipe-operator"><span class="toc-section-number">5.6.2</span>  The basic pipe operator</a></li>
  <li><a href="#an-example-without-pipes" id="toc-an-example-without-pipes" class="nav-link" data-scroll-target="#an-example-without-pipes"><span class="toc-section-number">5.6.3</span>  An example without pipes</a></li>
  <li><a href="#the-same-example-using-pipes" id="toc-the-same-example-using-pipes" class="nav-link" data-scroll-target="#the-same-example-using-pipes"><span class="toc-section-number">5.6.4</span>  The same example using pipes</a></li>
  <li><a href="#assigning-the-output-of-a-statement-involving-pipes-to-a-variable" id="toc-assigning-the-output-of-a-statement-involving-pipes-to-a-variable" class="nav-link" data-scroll-target="#assigning-the-output-of-a-statement-involving-pipes-to-a-variable"><span class="toc-section-number">5.6.5</span>  Assigning the output of a statement involving pipes to a variable</a></li>
  <li><a href="#compound-assignment-pipe-operator" id="toc-compound-assignment-pipe-operator" class="nav-link" data-scroll-target="#compound-assignment-pipe-operator"><span class="toc-section-number">5.6.6</span>  Compound assignment pipe operator</a></li>
  <li><a href="#the-dot-operator-with-pipes" id="toc-the-dot-operator-with-pipes" class="nav-link" data-scroll-target="#the-dot-operator-with-pipes"><span class="toc-section-number">5.6.7</span>  The dot operator with pipes</a></li>
  <li><a href="#the-exposition-pipe-operator" id="toc-the-exposition-pipe-operator" class="nav-link" data-scroll-target="#the-exposition-pipe-operator"><span class="toc-section-number">5.6.8</span>  The exposition pipe operator</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to <code>dplyr</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In today’s class we introduce a new package, <code>dplyr</code>, which, along with ggplot2 will be used in almost every class session. We will also introduce the <code>readr</code> package, for reading tabular data.</p>
<section id="libraries" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="libraries"><span class="header-section-number">5.1</span> Libraries</h2>
<p>Both <code>readr</code> and <code>dplyr</code> are members of the tidyverse, so a single invocation of <code>library()</code> makes the functions defined in these two packages available for our use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reading-data-with-the-readr-package" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="reading-data-with-the-readr-package"><span class="header-section-number">5.2</span> Reading data with the <code>readr</code> package</h2>
<p>The <a href="http://readr.tidyverse.org"><code>readr</code></a> package defines a number of functions for reading data tables from common file formats like Comma-Separated-Value (CSV) and Tab-Separated-Value (TSV) files.</p>
<p>The two most frequently used <code>readr</code> functions we’ll use in this class are <code>read_csv()</code> and <code>read_tsv()</code> for reading CSV and TSV files respectively. There are some variants of these basic function, which you can read about by invoking the help system (<code>?read_csv</code>).</p>
<section id="reading-excel-files" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="reading-excel-files"><span class="header-section-number">5.2.1</span> Reading Excel files</h3>
<p>The tidyverse also includes a package called <a href="http://readxl.tidyverse.org"><code>readxl</code></a> which can be used to read Excel spreadsheets (recent versions with <code>.xls</code> and <code>.xlsx</code> extensions). Excel files are somewhat more complicated to deal with because they can include separate “sheets”. We won’t use <code>readxl</code> in this class, but documentation and examples of how <code>readxl</code> is used can be found at the page linked above.</p>
</section>
<section id="example-data-nc-births" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="example-data-nc-births"><span class="header-section-number">5.2.2</span> Example data: NC Births</h3>
<p>For today’s hands on session we’ll use a data set that contains information on 150 cases of mothers and their newborns in North Carolina in 2004. This data set is available at the following URL:</p>
<ul>
<li>https://github.com/Bio723-class/example-datasets/raw/master/nc-births.txt</li>
</ul>
<p>The births data is a TSV file, so we’ll use the <code>read_tsv()</code> function to read it:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>births <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"https://github.com/Bio723-class/example-datasets/raw/master/nc-births.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 150 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (3): premature, sexBaby, smoke
dbl (6): fAge, mAge, weeks, visits, gained, weight

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Notice that when you used <code>read_tsv()</code> the function printed information about how it “parsed” the data (i.e.&nbsp;the types it assigned to each of the columns).</p>
<p>The variables in the data set are:</p>
<ul>
<li>father’s age (<code>fAge</code>),</li>
<li>mother’s age (<code>mAge</code>),<br>
</li>
<li>weeks of gestation (<code>weeks</code>)</li>
<li>whether the birth was premature or full term (<code>premature</code>)</li>
<li>number of OB/GYN visits (<code>visits</code>)</li>
<li>mother’s weight gained in pounds (<code>gained</code>)</li>
<li>babies birth weight (<code>weight</code>)</li>
<li>sex of the baby (<code>sexBaby</code>)</li>
<li>whether the mother was a smoker (<code>smoke</code>).</li>
</ul>
<p>Notice too that we read the TSV file directly from a remote location via a URL. If instead, you wanted to load a local file on your computer you would specify the “path” – i.e.&nbsp;the location on your hard drive where you stored the file. For example, here is how I would load the same file if it was stored in the Downloads directory on my Mac laptop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the data from a local file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>births <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"/Users/pmagwene/Downloads/nc-births.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="a-note-on-tibbles" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="a-note-on-tibbles"><span class="header-section-number">5.3</span> A note on “tibbles”</h2>
<p>You may have noticed that most of the functions defined in tidyverse related packages return not data frames, but rather something called a “tibble”. You can think about tibbles as light-weight data frames. In fact if you ask about the “class” of a tibble you’ll see that it includes <code>data.frame</code> as one of it’s classes as well as <code>tbl</code> and <code>tbl_df</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(births)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame" </code></pre>
</div>
</div>
<p>There are some minor differences between data frame and tibbles. For example, tibbles print differently in the console and don’t automatically change variable names and types in the same way that standard data frames do. Usually tibbles can be used wherever a standard data frame is expected, but you may occasionally find a function that only works with a standard data frame. It’s easy to convert a tibble to a standard data frame using the <code>as.data.frame</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>births.std.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(births)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For more details about tibbles, see the <a href="http://r4ds.had.co.nz/tibbles.html">Tibbles chapter in R for Data Analysis</a>.</p>
</section>
<section id="data-filtering-and-transformation-with-dplyr" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="data-filtering-and-transformation-with-dplyr"><span class="header-section-number">5.4</span> Data filtering and transformation with <code>dplyr</code></h2>
<p><code>dplyr</code> is powerful tool for data filter and transformation. In the same way that <code>ggplot2</code> attempts to provide a “grammar of graphics”, <code>dplyr</code> aims to provide a “grammar of data manipulation”. In today’s material we will see how <code>dplyr</code> complements and simplifies standard data frame indexing and subsetting operations. However, <code>dplyr</code> is focused only on data frames and doesn’t completely replace the basic subsetting operations, and so being adept with both <code>dplyr</code> and the indexing approaches we’ve seen previously is important. If you’re curious about the name “dplyr”, the package’s originator Hadley Wickham says it’s supposed to invoke the idea of pliers for data frames (<a href="https://github.com/tidyverse/dplyr/issues/1857">Github: Meaning of dplyrs name</a>)</p>
</section>
<section id="dplyrs-verbs" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="dplyrs-verbs"><span class="header-section-number">5.5</span> dplyr’s “verbs”</h2>
<p>The primary functions in the <code>dplyr</code> package can be thought of as a set of “verbs”, each verb corresponding to a common data manipulation task. Some of the most frequently used verbs/functions in <code>dplyr</code> include:</p>
<ul>
<li><code>select</code> – select columns</li>
<li><code>filter</code> – filter rows</li>
<li><code>mutate</code> – create new columns</li>
<li><code>arrange</code>– reorder rows</li>
<li><code>summarize</code> – summarize values</li>
<li><code>group_by</code> – split data frame on some grouping variable. Can be powerfully combined with <code>summarize</code></li>
</ul>
<p>All of these functions return new data frames rather than modifying the existing data frame (though some of the functions support in place modification of data frames via optional arguments).We illustrate these below by example using the NC births data.</p>
<section id="select" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="select"><span class="header-section-number">5.5.1</span> <code>select</code></h3>
<p>The <code>select</code> function subsets the columns (variables) of a data frame. For example, to select just the weeks and weight columns from the births data set we could do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note I'm prefixing select with the package name (dplyr)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># to avoid name clashes with built-in select function</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>wks.weight <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(births, weeks, weight)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(wks.weight)  <span class="co"># dim should be 50 x 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 150   2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wks.weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  weeks weight
  &lt;dbl&gt;  &lt;dbl&gt;
1    39   6.88
2    39   7.69
3    40   8.88
4    40   9   
5    40   7.94
6    40   8.25</code></pre>
</div>
</div>
<p>The equivalent using standard indexing would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>wks.wt.alt <span class="ot">&lt;-</span> births[<span class="fu">c</span>(<span class="st">"weeks"</span>, <span class="st">"weight"</span>)]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(wks.wt.alt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 150   2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wks.wt.alt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  weeks weight
  &lt;dbl&gt;  &lt;dbl&gt;
1    39   6.88
2    39   7.69
3    40   8.88
4    40   9   
5    40   7.94
6    40   8.25</code></pre>
</div>
</div>
<p><strong>Notes</strong>:<br>
* The first argument to all of the <code>dplyr</code> functions is the data frame you’re operating on</p>
<ul>
<li>When using functions defined in <code>dplyr</code> and <code>ggplot2</code> variable names are (usually) not quoted or used with the <code>$</code> operator. This is a design feature of these libraries and makes it easier to carry out interactive analyes because it saves a fair amount of typing.</li>
</ul>
</section>
<section id="filter" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="filter"><span class="header-section-number">5.5.2</span> <code>filter</code></h3>
<p>The <code>filter</code> function returns those rows of the data set that meet the given logical criterion.</p>
<p>For example, to get all the premature babies in the data set we could use filter as so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>premies <span class="ot">&lt;-</span> <span class="fu">filter</span>(births, premature <span class="sc">==</span> <span class="st">"premie"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(premies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21  9</code></pre>
</div>
</div>
<p>The equivalent using standard indexing would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>premies.alt <span class="ot">&lt;-</span> births[births<span class="sc">$</span>premature <span class="sc">==</span> <span class="st">"premie"</span>,] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>filter</code> function will work with more than one logical argument, and these are joined together using Boolean AND logic (i.e.&nbsp;intersection). For example, to find those babies that were premature <em>and</em> whose mothers were smokers we could do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>smoking.premies <span class="ot">&lt;-</span> <span class="fu">filter</span>(births, premature <span class="sc">==</span> <span class="st">"premie"</span>, smoke <span class="sc">==</span> <span class="st">"smoker"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The equivalent call using standard indexing is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># don't forget the trailing comma to indicate rows!</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>smoking.premies.alt <span class="ot">&lt;-</span> births[(births<span class="sc">$</span>premature <span class="sc">==</span> <span class="st">"premie"</span>) <span class="sc">&amp;</span> (births<span class="sc">$</span>smoke <span class="sc">==</span> <span class="st">"smoker"</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>filter</code> also accepts logical statements chained together using the standard Boolean operators. For example, to find babies who were premature <em>or</em> whose moms were older than 35 you could use the OR operator <code>|</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>premies.or.oldmom <span class="ot">&lt;-</span> <span class="fu">filter</span>(births, premature <span class="sc">==</span> <span class="st">"premie"</span> <span class="sc">|</span> fAge <span class="sc">&gt;</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mutate" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="mutate"><span class="header-section-number">5.5.3</span> <code>mutate</code></h3>
<p>The <code>mutate</code> function creates a new data frame that is the same as input data frame but with additional variables (columns) as specified by the function arguments. In the example below, I create two new variables, <code>weight.in.kg</code> and a <code>mom.smoked</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to make code more readable it's sometime useful to spread out</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># function arguments over multiple lines like I've done here</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>births.plus <span class="ot">&lt;-</span> <span class="fu">mutate</span>(births, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weight.in.kg =</span> weight <span class="sc">/</span> <span class="fl">2.2</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mom.smoked =</span> (smoke <span class="sc">==</span> <span class="st">"smoker"</span>))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(births.plus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
   fAge  mAge weeks premature visits gained weight sexBaby smoke weigh…¹ mom.s…²
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;lgl&gt;  
1    31    30    39 full term     13      1   6.88 male    smok…    3.13 TRUE   
2    34    36    39 full term      5     35   7.69 male    nons…    3.50 FALSE  
3    36    35    40 full term     12     29   8.88 male    nons…    4.04 FALSE  
4    41    40    40 full term     13     30   9    female  nons…    4.09 FALSE  
5    42    37    40 full term     NA     10   7.94 male    nons…    3.61 FALSE  
6    37    28    40 full term     12     35   8.25 male    smok…    3.75 TRUE   
# … with abbreviated variable names ¹​weight.in.kg, ²​mom.smoked</code></pre>
</div>
</div>
<p>The equivalent using standard indexing would be to create a new data frame from <code>births</code>, appending the new variables to the end as so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>births.plus.alt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(births,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weight.in.kg =</span> births<span class="sc">$</span>weight <span class="sc">/</span> <span class="fl">2.2</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mom.smoked =</span> (births<span class="sc">$</span>smoke <span class="sc">==</span> <span class="st">"smoker"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="arrange" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="arrange"><span class="header-section-number">5.5.4</span> <code>arrange</code></h3>
<p>Arrange creates a new data frame where the rows are sorted according to their values for one or more variables. For example, to sort by mothers age we could do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>young.moms.first <span class="ot">&lt;-</span> <span class="fu">arrange</span>(births, mAge)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(young.moms.first)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    18    15    37 full term     12     76   8.44 male    nonsmoker
2    NA    16    40 full term      4     12   6    female  nonsmoker
3    21    16    38 full term     15     75   7.56 female  smoker   
4    26    17    38 full term     11     30   9.5  female  nonsmoker
5    17    17    29 premie         4     10   2.63 female  nonsmoker
6    20    17    40 full term     17     38   7.19 male    nonsmoker</code></pre>
</div>
</div>
<p>The equivalent to <code>arrange</code> using standard indexing would be to use the information returned by the <code>order</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>young.moms.first.alt <span class="ot">&lt;-</span> births[<span class="fu">order</span>(births<span class="sc">$</span>mAge),]</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(young.moms.first.alt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    18    15    37 full term     12     76   8.44 male    nonsmoker
2    NA    16    40 full term      4     12   6    female  nonsmoker
3    21    16    38 full term     15     75   7.56 female  smoker   
4    26    17    38 full term     11     30   9.5  female  nonsmoker
5    17    17    29 premie         4     10   2.63 female  nonsmoker
6    20    17    40 full term     17     38   7.19 male    nonsmoker</code></pre>
</div>
</div>
<p>When using <code>arrange</code>, multiple sorting variables can be specified:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sorted.by.moms.and.dads <span class="ot">&lt;-</span> <span class="fu">arrange</span>(births, mAge, fAge)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted.by.moms.and.dads)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    18    15    37 full term     12     76   8.44 male    nonsmoker
2    21    16    38 full term     15     75   7.56 female  smoker   
3    NA    16    40 full term      4     12   6    female  nonsmoker
4    17    17    29 premie         4     10   2.63 female  nonsmoker
5    20    17    40 full term     17     38   7.19 male    nonsmoker
6    26    17    38 full term     11     30   9.5  female  nonsmoker</code></pre>
</div>
</div>
<p>If you want to sort in descending order, you can combing <code>arrange</code> with the <code>desc</code> (=descend) function, also defined in <code>dplyr</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>old.moms.first <span class="ot">&lt;-</span> <span class="fu">arrange</span>(births, <span class="fu">desc</span>(mAge))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(old.moms.first)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    NA    41    33 premie        13      0   5.69 female  nonsmoker
2    41    40    40 full term     13     30   9    female  nonsmoker
3    33    40    36 premie        13     23   7.81 female  nonsmoker
4    40    40    38 full term     13     38   7.31 male    nonsmoker
5    46    39    38 full term     10     35   6.75 male    smoker   
6    NA    38    32 premie        10     16   2.19 female  smoker   </code></pre>
</div>
</div>
</section>
<section id="summarize" class="level3" data-number="5.5.5">
<h3 data-number="5.5.5" class="anchored" data-anchor-id="summarize"><span class="header-section-number">5.5.5</span> <code>summarize</code></h3>
<p><code>summarize</code> applies a function of interest to one or more variables in a data frame, reducing a vector of values to a single value and returning the results in a data frame. This is most often used to calculate statistics like means, medians, count, etc. As we’ll see below, this is powerful when combined with the <code>group_by</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(births, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean.wt =</span> <span class="fu">mean</span>(weight), </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">median.wks =</span> <span class="fu">median</span>(weeks))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean.wt median.wks
    &lt;dbl&gt;      &lt;dbl&gt;
1    7.05         39</code></pre>
</div>
</div>
<p>You’ll need to be diligent if your data has missing values (NAs). For example, by default the <code>mean</code> function returns NA if any of the input values are NA:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(births, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean.gained =</span> <span class="fu">mean</span>(gained))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  mean.gained
        &lt;dbl&gt;
1          NA</code></pre>
</div>
</div>
<p>However, if you read the <code>mean</code> docs (<code>?mean</code>) you’ll see that there is an <code>na.rm</code> argument that indicates whether NA values should be removed before computing the mean. This is what we want so we instead call summarize as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(births, </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean.gained =</span> <span class="fu">mean</span>(gained, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  mean.gained
        &lt;dbl&gt;
1        32.5</code></pre>
</div>
</div>
</section>
<section id="group_by" class="level3" data-number="5.5.6">
<h3 data-number="5.5.6" class="anchored" data-anchor-id="group_by"><span class="header-section-number">5.5.6</span> <code>group_by</code></h3>
<p>The <code>group_by</code> function implicitly adds grouping information to a data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group the births by whether mom smoked or not</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>by_smoking <span class="ot">&lt;-</span> <span class="fu">group_by</span>(births, smoke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The object returned by <code>group_by</code> is a “grouped data frame”:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(by_smoking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<p>Some functions, like <code>count()</code> and <code>summarize()</code> (see below) know how to use the grouping information. For example, to count the number of births conditional on mother smoking status we could do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count</span>(by_smoking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
# Groups:   smoke [2]
  smoke         n
  &lt;chr&gt;     &lt;int&gt;
1 nonsmoker   100
2 smoker       50</code></pre>
</div>
</div>
<p><code>group_by</code> also works with multiple grouping variables, with each added grouping variable specified as an additional argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>by_smoking.and.mAge <span class="ot">&lt;-</span> <span class="fu">group_by</span>(births, smoke, mAge <span class="sc">&gt;</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="combining-grouping-and-summarizing" class="level3" data-number="5.5.7">
<h3 data-number="5.5.7" class="anchored" data-anchor-id="combining-grouping-and-summarizing"><span class="header-section-number">5.5.7</span> Combining grouping and summarizing</h3>
<p>Grouped data frames can be combined with the <code>summarize</code> function we saw above. For example, if we wanted to calculate mean birth weight, broken down by whether the baby’s mother smoked or not we could call <code>summarize</code> with our <code>by_smoking</code> grouped data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(by_smoking, <span class="at">mean.wt =</span> <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  smoke     mean.wt
  &lt;chr&gt;       &lt;dbl&gt;
1 nonsmoker    7.18
2 smoker       6.78</code></pre>
</div>
</div>
<p>Similarly to get the mean birth weight of children conditioned on mothers smoking status and age:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(by_smoking.and.mAge, <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'smoke'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   smoke [2]
  smoke     `mAge &gt; 35` `mean(weight)`
  &lt;chr&gt;     &lt;lgl&gt;                &lt;dbl&gt;
1 nonsmoker FALSE                 7.17
2 nonsmoker TRUE                  7.26
3 smoker    FALSE                 6.83
4 smoker    TRUE                  6.30</code></pre>
</div>
</div>
</section>
<section id="scoped-variants-of-mutate-and-summarize" class="level3" data-number="5.5.8">
<h3 data-number="5.5.8" class="anchored" data-anchor-id="scoped-variants-of-mutate-and-summarize"><span class="header-section-number">5.5.8</span> Scoped variants of <code>mutate</code> and <code>summarize</code></h3>
<p>Both the <code>mutate()</code> and <code>summarize()</code> functions provide “scoped” alternatives, that allow us to apply the operation on a selection of variables. These variants are often used in combination with grouping. We’ll look at the <code>summarize</code> versions – <code>summarize_all()</code>, <code>summarize_at()</code>, and <code>summarize_if()</code>. See the documentation (<code>?mutate_all</code>) for descriptions of the <code>mutate</code> versions.</p>
<section id="summarize_all" class="level4" data-number="5.5.8.1">
<h4 data-number="5.5.8.1" class="anchored" data-anchor-id="summarize_all"><span class="header-section-number">5.5.8.1</span> <code>summarize_all()</code></h4>
<p><code>summarize_all()</code> applies a one or more functions to all columns in a data frame. Here we illustrate a simple version of this with the iris data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group by species</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>by_species <span class="ot">&lt;-</span> <span class="fu">group_by</span>(iris, Species)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the mean of every variable, grouped by species</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_all</span>(by_species, mean)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  Species    Sepal.Length Sepal.Width Petal.Length Petal.Width
  &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 setosa             5.01        3.43         1.46       0.246
2 versicolor         5.94        2.77         4.26       1.33 
3 virginica          6.59        2.97         5.55       2.03 </code></pre>
</div>
</div>
<p>Note that if we try and apply <code>summarize_all()</code> in the same way to the grouped data frame <code>by_smoking</code> we’ll get a bunch of warning messages:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_all</span>(by_smoking, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 9
  smoke      fAge  mAge weeks premature visits gained weight sexBaby
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 nonsmoker    NA  26.9  38.6        NA   NA       NA   7.18      NA
2 smoker       NA  26    38.5        NA   10.8     NA   6.78      NA</code></pre>
</div>
</div>
<p>Here’s an example of one of these warnings:</p>
<pre><code>Warning messages:
1: In mean.default(premature) :
  argument is not numeric or logical: returning NA</code></pre>
<p>This message is telling us that we can’t apply the <code>mean()</code> function to the data frame column <code>premature</code> because this is not a numerical or logical vector. Despite this and the other similar warnings, <code>summarize_all()</code> does return a result, but the means for any non-numeric values are replaced with NAs, as shown below:</p>
<pre><code># A tibble: 2 x 9
  smoke      fAge  mAge weeks premature visits gained weight sexBaby
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 nonsmoker    NA  26.9  38.6        NA   NA       NA   7.18      NA
2 smoker       NA  26.0  38.5        NA   10.8     NA   6.78      NA</code></pre>
<p>If you examine the output above, you’ll see that there are several variables that are numeric, however we still got NAs when we calculated the grouped means. This is because those variables contain NA values. The <code>mean</code> function has an optional argument, <code>na.rm</code>, which tells the function to remove any missing data before calculating the mean. Thus we can modify our call to <code>summarize_all</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean of all variables, grouped by smoking status</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_all</span>(by_smoking, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(premature, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(premature, na.rm = TRUE): argument is not numeric or
logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in mean.default(sexBaby, na.rm = TRUE): argument is not numeric or
logical: returning NA

Warning in mean.default(sexBaby, na.rm = TRUE): argument is not numeric or
logical: returning NA</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 9
  smoke      fAge  mAge weeks premature visits gained weight sexBaby
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1 nonsmoker  29.8  26.9  38.6        NA   11.9   32.5   7.18      NA
2 smoker     29.7  26    38.5        NA   10.8   32.3   6.78      NA</code></pre>
</div>
</div>
<p>Note that the non-numeric data columns still lead to NA values.</p>
</section>
<section id="summarize_if" class="level4" data-number="5.5.8.2">
<h4 data-number="5.5.8.2" class="anchored" data-anchor-id="summarize_if"><span class="header-section-number">5.5.8.2</span> <code>summarize_if()</code></h4>
<p><code>summarize_if()</code> is similar to <code>summarize_all()</code>, except it only applies the function of interest to those variables that match a particular predicate (i.e.&nbsp;are TRUE for a particular TRUE/FALSE test).</p>
<p>Here we use <code>summarize_if()</code> to apply the <code>mean()</code> function to only those variables (columns) that are numeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean of all numeric variables, grouped by smoking status</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_if</span>(by_smoking, is.numeric, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  smoke      fAge  mAge weeks visits gained weight
  &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 nonsmoker  29.8  26.9  38.6   11.9   32.5   7.18
2 smoker     29.7  26    38.5   10.8   32.3   6.78</code></pre>
</div>
</div>
</section>
<section id="summarize_at" class="level4" data-number="5.5.8.3">
<h4 data-number="5.5.8.3" class="anchored" data-anchor-id="summarize_at"><span class="header-section-number">5.5.8.3</span> <code>summarize_at()</code></h4>
<p><code>summarize_at()</code> allows us to apply functions of interest only to specific variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean of gained and weight variables, grouped by smoking status</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_at</span>(by_smoking, <span class="fu">c</span>(<span class="st">"gained"</span>, <span class="st">"weight"</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  smoke     gained weight
  &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
1 nonsmoker   32.5   7.18
2 smoker      32.3   6.78</code></pre>
</div>
</div>
<p>All three of the scoped summarize functions can also be used to apply multiple functions, by wrapping the function names in a call to <code>dplyr::funs()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean and std deviation of </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gained and weight variables, grouped by smoking status</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_at</span>(by_smoking, <span class="fu">c</span>(<span class="st">"gained"</span>, <span class="st">"weight"</span>), <span class="fu">funs</span>(mean, sd), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `funs()` was deprecated in dplyr 0.8.0.
ℹ Please use a list of either functions or lambdas:

# Simple named list: list(mean = mean, median = median)

# Auto named with `tibble::lst()`: tibble::lst(mean, median)

# Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  smoke     gained_mean weight_mean gained_sd weight_sd
  &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 nonsmoker        32.5        7.18      15.2      1.43
2 smoker           32.3        6.78      16.6      1.60</code></pre>
</div>
</div>
<p><code>summarize_at()</code> accepts as the the argument for variables a character vector of column names, a numeric vector of column positions, or a list of columns generated by the <code>dplyr::vars()</code> function, which can be be used as so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reformatted to promote readability of arguments</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize_at</span>(by_smoking, </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">vars</span>(gained, weight),</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">funs</span>(mean, sd),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  smoke     gained_mean weight_mean gained_sd weight_sd
  &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 nonsmoker        32.5        7.18      15.2      1.43
2 smoker           32.3        6.78      16.6      1.60</code></pre>
</div>
</div>
</section>
</section>
<section id="combining-summarize-with-grouping-aesthetics-in-ggplot2" class="level3" data-number="5.5.9">
<h3 data-number="5.5.9" class="anchored" data-anchor-id="combining-summarize-with-grouping-aesthetics-in-ggplot2"><span class="header-section-number">5.5.9</span> Combining summarize with grouping aesthetics in <code>ggplot2</code></h3>
<p>We’ve already seen an instance of grouping (conditioning) when we used aesthetics like color or fill to distinguish subgroups in different types of statistical graphics. Below is an example where we integrate information from a <code>group_by</code>/<code>summarize</code> operation into a plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate mean weights, conditioned on smoking status</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>wt.by.smoking <span class="ot">&lt;-</span> </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(by_smoking, <span class="at">mean_weight =</span> <span class="fu">mean</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create density plot for all the data</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co"># and then use geom_vline to draw vertical lines at the means for</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="co"># each group</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(births) <span class="sc">+</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">color =</span> smoke)) <span class="sc">+</span> <span class="co"># data drawn from births</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> wt.by.smoking,  <span class="co"># note use of different data frame!</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xintercept =</span> mean_weight, <span class="at">color =</span> smoke),</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">'dashed'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R-dplyr-intro_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="pipes" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="pipes"><span class="header-section-number">5.6</span> Pipes</h2>
<p><code>dplyr</code> includes a very useful operator available called a pipe available to us. Pipes are powerful because they allow us to chain together sets of operations in a very intuitive fashion while minimizing nested function calls. We can think of pipes as taking the output of one function and feeding it as the <em>first argument</em> to another function call, where we’ve already specified the subsequent arguments.</p>
<p>Pipes are actually defined in another packaged called <code>magrittr</code>. We’ll look at the basic pipe operator and then look at a few additional “special” pipes that <code>magrittr</code> provides.</p>
<section id="install-and-load-magrittr" class="level3" data-number="5.6.1">
<h3 data-number="5.6.1" class="anchored" data-anchor-id="install-and-load-magrittr"><span class="header-section-number">5.6.1</span> Install and load <code>magrittr</code></h3>
<p>In magrittr in not already installed, install it via the command line or the RStudio GUI. Having done so, you will need to load magrittr via the <code>library()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-basic-pipe-operator" class="level3" data-number="5.6.2">
<h3 data-number="5.6.2" class="anchored" data-anchor-id="the-basic-pipe-operator"><span class="header-section-number">5.6.2</span> The basic pipe operator</h3>
<p>The pipe operator is designated by <code>%&gt;%</code>. Using pipes, the expression <code>x %&gt;% f()</code> is equivalent to <code>f(x)</code> and the expression <code>x %&gt;% f(y)</code> is equivalent to <code>f(x,y)</code>. The documentation on pipes (see <code>?magrittr</code>) uses the notation <code>lhs %&gt;% rhs</code> where <code>lhs</code> and <code>rhs</code> are short for “left-hand side” and “right-hand side” respectively. I’ll use this same notation in some of the explanations that follow.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span> <span class="fu">head</span>()   <span class="co"># same as head(births)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    31    30    39 full term     13      1   6.88 male    smoker   
2    34    36    39 full term      5     35   7.69 male    nonsmoker
3    36    35    40 full term     12     29   8.88 male    nonsmoker
4    41    40    40 full term     13     30   9    female  nonsmoker
5    42    37    40 full term     NA     10   7.94 male    nonsmoker
6    37    28    40 full term     12     35   8.25 male    smoker   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span> head     <span class="co"># you can even leave the parentheses out</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
   fAge  mAge weeks premature visits gained weight sexBaby smoke    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
1    31    30    39 full term     13      1   6.88 male    smoker   
2    34    36    39 full term      5     35   7.69 male    nonsmoker
3    36    35    40 full term     12     29   8.88 male    nonsmoker
4    41    40    40 full term     13     30   9    female  nonsmoker
5    42    37    40 full term     NA     10   7.94 male    nonsmoker
6    37    28    40 full term     12     35   8.25 male    smoker   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) <span class="co"># same as head(births, 10)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
    fAge  mAge weeks premature visits gained weight sexBaby smoke    
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
 1    31    30    39 full term     13      1   6.88 male    smoker   
 2    34    36    39 full term      5     35   7.69 male    nonsmoker
 3    36    35    40 full term     12     29   8.88 male    nonsmoker
 4    41    40    40 full term     13     30   9    female  nonsmoker
 5    42    37    40 full term     NA     10   7.94 male    nonsmoker
 6    37    28    40 full term     12     35   8.25 male    smoker   
 7    35    35    28 premie         6     29   1.63 female  nonsmoker
 8    28    21    35 premie         9     15   5.5  female  smoker   
 9    22    20    32 premie         5     40   2.69 male    smoker   
10    36    25    40 full term     13     34   8.75 female  nonsmoker</code></pre>
</div>
</div>
<p>Multiple pipes can be chained together, such that <code>x %&gt;% f() %&gt;% g() %&gt;% h()</code> is equivalent to <code>h(g(f(x)))</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent to: head(arrange(births, weight), 10)</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(weight) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
    fAge  mAge weeks premature visits gained weight sexBaby smoke    
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
 1    35    35    28 premie         6     29   1.63 female  nonsmoker
 2    NA    18    33 premie         7     40   1.69 male    smoker   
 3    NA    38    32 premie        10     16   2.19 female  smoker   
 4    17    17    29 premie         4     10   2.63 female  nonsmoker
 5    22    20    32 premie         5     40   2.69 male    smoker   
 6    38    37    26 premie         5     25   3.63 male    nonsmoker
 7    25    22    34 premie        10     20   3.75 male    nonsmoker
 8    NA    24    38 full term     16     50   3.75 female  nonsmoker
 9    30    25    35 premie        15     40   4.5  male    smoker   
10    19    20    34 premie        13      6   4.5  male    nonsmoker</code></pre>
</div>
</div>
<p>When there are multiple piping operations, I like to arrange the statements vertically to help emphasize the flow of processing and to facilitate debugging and/or modification. I would usually rearrange the above code block as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(weight) <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 9
    fAge  mAge weeks premature visits gained weight sexBaby smoke    
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;    
 1    35    35    28 premie         6     29   1.63 female  nonsmoker
 2    NA    18    33 premie         7     40   1.69 male    smoker   
 3    NA    38    32 premie        10     16   2.19 female  smoker   
 4    17    17    29 premie         4     10   2.63 female  nonsmoker
 5    22    20    32 premie         5     40   2.69 male    smoker   
 6    38    37    26 premie         5     25   3.63 male    nonsmoker
 7    25    22    34 premie        10     20   3.75 male    nonsmoker
 8    NA    24    38 full term     16     50   3.75 female  nonsmoker
 9    30    25    35 premie        15     40   4.5  male    smoker   
10    19    20    34 premie        13      6   4.5  male    nonsmoker</code></pre>
</div>
</div>
</section>
<section id="an-example-without-pipes" class="level3" data-number="5.6.3">
<h3 data-number="5.6.3" class="anchored" data-anchor-id="an-example-without-pipes"><span class="header-section-number">5.6.3</span> An example without pipes</h3>
<p>To illustrate how pipes help us, first let’s look at an example set of analysis steps without using pipes. Let’s say we wanted to explore the relationship between father’s age and baby’s birth weight. We’ll start this process of exploration by generating a bivariate scatter plot. Being good scientists we want to express our data in SI units, so we’ll need to converts pounds to kilograms. You’ll also recall that a number of the cases have missing data on father’s age, so we’ll want to remove those before we plot them. Here’s how we might accomplish these steps:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a new column for weight in kg</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>births.kg <span class="ot">&lt;-</span> <span class="fu">mutate</span>(births, <span class="at">weight.kg =</span> weight <span class="sc">/</span> <span class="fl">2.2</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out the NA fathers</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>filtered.births <span class="ot">&lt;-</span> <span class="fu">filter</span>(births.kg, <span class="sc">!</span><span class="fu">is.na</span>(fAge))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create our plot</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(filtered.births, <span class="fu">aes</span>(<span class="at">x =</span> fAge, <span class="at">y =</span> weight.kg)) <span class="sc">+</span> </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Father's Age (years)"</span>, <span class="at">y =</span> <span class="st">"Birth Weight (kg)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R-dplyr-intro_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that we created two “temporary” data frames along the way – <code>births.kg</code> and <code>filtered.births</code>. These probably aren’t of particular interest to us, but we needed to generate them to build the plot we wanted. If you were particularly masochistic you could avoid these temporary data frames by using nested functions call like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You SHOULD NOT write nested code like this.</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Code like this is hard to debug and understand!</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">filter</span>(<span class="fu">mutate</span>(births, <span class="at">weight.kg =</span> weight <span class="sc">/</span> <span class="fl">2.2</span>), <span class="sc">!</span><span class="fu">is.na</span>(fAge)), </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> fAge, <span class="at">y =</span> weight.kg)) <span class="sc">+</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Father's Age (years)"</span>, <span class="at">y =</span> <span class="st">"Birth Weight (kg)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-same-example-using-pipes" class="level3" data-number="5.6.4">
<h3 data-number="5.6.4" class="anchored" data-anchor-id="the-same-example-using-pipes"><span class="header-section-number">5.6.4</span> The same example using pipes</h3>
<p>The pipe operator makes the output of one statement (<code>lhs</code>) as the first input of a following function (<code>rhs</code>). This simplifies the above example to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight.kg =</span> weight <span class="sc">/</span> <span class="fl">2.2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(fAge)) <span class="sc">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> fAge, <span class="at">y =</span> weight.kg)) <span class="sc">+</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Father's Age (years)"</span>, <span class="at">y =</span> <span class="st">"Birth Weight (kg)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="R-dplyr-intro_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In the example above, we feed the data frame into the <code>mutate</code> function. <code>mutate</code> expects a data frame as a first argument, and subsequent arguments specify the new variables to be created. <code>births %&gt;% mutate(weight.kg = weight / 2.2)</code> is thus equivalent to <code>mutate(births, weight.kg = weight / 2.2))</code>. We then pipe the output to <code>filter</code>, removing NA fathers, and then pipe that output as the input to ggplot.</p>
<p>As mentioned previously, it’s good coding style to write each discrete step as its own line when using piping. This make it easier to understand what the steps of the analysis are as well as facilitating changes to the code (commenting out lines, adding lines, etc)</p>
</section>
<section id="assigning-the-output-of-a-statement-involving-pipes-to-a-variable" class="level3" data-number="5.6.5">
<h3 data-number="5.6.5" class="anchored" data-anchor-id="assigning-the-output-of-a-statement-involving-pipes-to-a-variable"><span class="header-section-number">5.6.5</span> Assigning the output of a statement involving pipes to a variable</h3>
<p>It’s important to recognize that pipes are simply a convenient way to chain together a series of expression. Just like any other compound expression, the output of a series of pipe statements can be assigned to a variable, like so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>stats.old.moms <span class="ot">&lt;-</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  births <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mAge <span class="sc">&gt;</span> <span class="dv">35</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median.gestation =</span> <span class="fu">median</span>(weeks), </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean.weight =</span> <span class="fu">mean</span>(weight))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>stats.old.moms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  median.gestation mean.weight
             &lt;dbl&gt;       &lt;dbl&gt;
1               38        6.94</code></pre>
</div>
</div>
<p>Note that our summary table, <code>stats.old.moms</code>, is itself a data frame.</p>
</section>
<section id="compound-assignment-pipe-operator" class="level3" data-number="5.6.6">
<h3 data-number="5.6.6" class="anchored" data-anchor-id="compound-assignment-pipe-operator"><span class="header-section-number">5.6.6</span> Compound assignment pipe operator</h3>
<p>A fairly common operation when working interactively in R is to update an existing data frame. <code>magrittr</code> defines another pipe operator – <code>%&lt;&gt;%</code> – called the “compound assignment” pipe operator, to facilitate this. The compound assignment pipe operator has the basic usage <code>lhs %&lt;&gt;% rhs</code>. This operator evaluates the function on the <code>rhs</code> using the <code>lhs</code> as the first argument, and <em>then</em> updates the <code>lhs</code> with the resulting value. This is simply shorthand for writing <code>lhs &lt;- lhs %&gt;% rhs</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>stats.old.moms <span class="sc">%&lt;&gt;%</span>  <span class="co"># note compound pipe operator!</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean.weight.kg =</span> mean.weight <span class="sc">/</span> <span class="fl">2.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-dot-operator-with-pipes" class="level3" data-number="5.6.7">
<h3 data-number="5.6.7" class="anchored" data-anchor-id="the-dot-operator-with-pipes"><span class="header-section-number">5.6.7</span> The dot operator with pipes</h3>
<p>When working with pipes, sometimes you’ll want to use the <code>lhs</code> in multiple places on the <code>rhs</code>, or as something other than the first argument to the <code>rhs</code>. <code>magrittr</code> provides for this situation by using the dot (<code>.</code>) operator as a placeholder. Using the dot operator, the expression <code>y %&gt;% f(x, .)</code> is equivalent to <code>f(x,y)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"dog"</span>, <span class="st">"cakes"</span>, <span class="st">"sauce"</span>, <span class="st">"house"</span>) <span class="sc">%&gt;%</span>  <span class="co"># create a vector</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="co"># pick a random single element of that vector</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">"hot"</span>, .)  <span class="co"># string concatenate the pick with the word "hot"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hotsauce"</code></pre>
</div>
</div>
</section>
<section id="the-exposition-pipe-operator" class="level3" data-number="5.6.8">
<h3 data-number="5.6.8" class="anchored" data-anchor-id="the-exposition-pipe-operator"><span class="header-section-number">5.6.8</span> The exposition pipe operator</h3>
<p><code>magrittr</code> defines another operator called the “exposition pipe operator”, designed <code>%$%</code>. This operator exposes the names in the <code>lhs</code> to the expression on the <code>rhs</code>.</p>
<p>Here is an example of using the exposition pipe operator to simply return the vector of weights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(premature <span class="sc">==</span> <span class="st">"premie"</span>) <span class="sc">%$%</span>  <span class="co"># note the different pipe operator!</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  weight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.63 5.50 2.69 6.50 7.81 4.75 3.75 2.19 6.81 4.69 6.75 4.50 5.94 4.50 5.06
[16] 5.69 1.69 6.31 2.63 5.88 3.63</code></pre>
</div>
</div>
<p>If we wanted to calculate the minimum and maximum weight of premature babies in the data set we could do the following (though I’d usually prefer <code>summarize()</code> unless I needed the results in the form of a vector):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>births <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mAge <span class="sc">&gt;</span> <span class="dv">35</span>) <span class="sc">%$%</span>  <span class="co"># note the different pipe operator!</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="fu">min</span>(weight), <span class="fu">max</span>(weight)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2.19 10.13</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./R-intro-RMarkdown.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">R Markdown and R Notebooks</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./R-ggplot-intro.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to ggplot2</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>